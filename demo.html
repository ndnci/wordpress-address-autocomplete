<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test - WordPress Address Autocomplete</title>

        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

        <!-- Plugin CSS -->
        <link rel="stylesheet" href="assets/css/frontend.css" />

        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell,
                    "Helvetica Neue", sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                background: #f5f5f5;
            }

            .wpcf7 {
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            label {
                display: block;
                margin-bottom: 20px;
                font-weight: 500;
            }

            input[type="text"],
            input[type="email"],
            textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-top: 5px;
                box-sizing: border-box;
            }

            input[type="submit"] {
                background: #0073aa;
                color: white;
                padding: 12px 30px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-top: 20px;
            }

            input[type="submit"]:hover {
                background: #005177;
            }

            h1 {
                color: #333;
                margin-bottom: 10px;
            }

            .notice {
                background: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 15px;
                margin-bottom: 20px;
                border-radius: 4px;
            }

            .notice strong {
                display: block;
                margin-bottom: 5px;
            }

            .ndnci-wpaa-map {
                margin-bottom: 20px;
            }
        </style>
    </head>
    <body>
        <h1>Test Contact Form 7 with Address Autocomplete</h1>

        <form class="wpcf7">
            <label>
                Departure address
                <span class="ndnci-wpaa-field-wrapper">
                    <span class="wpcf7-form-control-wrap address_autocomplete-1">
                        <input
                            type="text"
                            name="address_autocomplete-1"
                            class="wpcf7-form-control ndnci-wpaa-address-field"
                            placeholder="Departure address"
                            autocomplete="off"
                        />
                    </span>
                    <div class="ndnci-wpaa-suggestions"></div>
                    <input type="hidden" name="address_autocomplete-1_place_id" class="ndnci-wpaa-place-id" />
                </span>
            </label>

            <label>
                Destination address
                <span class="ndnci-wpaa-field-wrapper">
                    <span class="wpcf7-form-control-wrap address_autocomplete-2">
                        <input
                            type="text"
                            name="address_autocomplete-2"
                            class="wpcf7-form-control ndnci-wpaa-address-field"
                            placeholder="Destination address"
                            autocomplete="off"
                            aria-required="true"
                        />
                    </span>
                    <div class="ndnci-wpaa-suggestions"></div>
                    <input type="hidden" name="address_autocomplete-2_place_id" class="ndnci-wpaa-place-id" />
                </span>
            </label>

            <!-- Carte pour afficher les adresses -->
            <div
                class="ndnci-wpaa-map"
                id="address_map-161"
                data-fields="address_autocomplete-1,address_autocomplete-2"
                data-mode="markers"
                style="height: 400px"
            ></div>

            <label>
                Your name
                <input type="text" name="your-name" required />
            </label>

            <label>
                Your email
                <input type="email" name="your-email" required />
            </label>

            <label>
                Subject
                <input type="text" name="your-subject" required />
            </label>

            <label>
                Your message (optional)
                <textarea name="your-message" rows="5"></textarea>
            </label>

            <input type="submit" value="Send" />
        </form>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Leaflet JS -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <!-- Plugin JS -->
        <script>
            // Mock WordPress data for testing
            var ndnciWpaaData = {
                ajaxUrl: "http://localhost/wp-admin/admin-ajax.php",
                nonce: "test-nonce",
                provider: "openstreetmap",
                i18n: {
                    searching: "Searching...",
                    noResults: "No results found",
                    error: "An error occurred. Please try again.",
                    selectAddress: "Select an address",
                },
            };
        </script>
        <script src="assets/js/frontend.js"></script>

        <script>
            // Mock AJAX for demo
            if (typeof jQuery !== "undefined") {
                var originalAjax = jQuery.ajax;
                jQuery.ajax = function (options) {
                    // Simulate search results
                    if (options.data && options.data.action === "ndnci_wpaa_search") {
                        setTimeout(function () {
                            options.success({
                                success: true,
                                data: {
                                    results: [
                                        {
                                            place_id: "test-1",
                                            description: "Paris, France",
                                            address: {
                                                street: "Champs-Élysées",
                                                postal_code: "75008",
                                                city: "Paris",
                                            },
                                        },
                                        {
                                            place_id: "test-2",
                                            description: "Lyon, France",
                                            address: {
                                                street: "Place Bellecour",
                                                postal_code: "69002",
                                                city: "Lyon",
                                            },
                                        },
                                    ],
                                },
                            });
                        }, 500);
                    }

                    // Simulate place details
                    if (options.data && options.data.action === "ndnci_wpaa_get_place_details") {
                        setTimeout(function () {
                            var lat = Math.random() * 10 + 45;
                            var lng = Math.random() * 10 + 0;

                            options.success({
                                success: true,
                                data: {
                                    details: {
                                        description: "Test Address",
                                        location: {
                                            lat: lat,
                                            lng: lng,
                                        },
                                    },
                                },
                            });
                        }, 300);
                    }
                };
            }
        </script>
    </body>
</html>
